Сниппет вывода таблицы сравнения.

## Параметры

Название			| По умолчанию													| Описание
--------------------|---------------------------------------------------------------|--------------------------------------------------------
**&fields**			| {"default":["price","article","vendor.name","color","size"]}	| JSON строка с массивом конфигурации списков сравнения. Ключ - это имя параметра, указанного в параметре **&list** сниппета [addComparison][1], а значения - массив сравниваемых полей товара.
**&tplRow**			| tpl.Comparison.row											| Чанк с одной строкой таблицы сравнения товаров. Плейсхолдеры `[[+cells]]` и `[[+same]]`.
**&tplParam**		| tpl.Comparison.param											| Чанк с именем параметра товара. Плейсхолдеры `[[+param]]` и `[[+row_idx]]`.
**&tplCell**		| tpl.Comparison.cell											| Ячейка таблицы сравнения с одним значением параметра товара. Плейсхолдеры tpl.Comparison.cell, `[[+classes]]` и `[[+cell_idx]]`.
**&tplHead**		| tpl.Comparison.head											| Ячейка заголовка товара в таблице сравнения. Здесь можно использовать все плейсхолдеры товара.
**&tplCorner**		| tpl.Comparison.corner											| Угловая ячейка таблицы, со ссылками на переключение параметров сравнения. Плейсхолдеров нет.
**&tplOuter**		| tpl.Comparison.outer											| Чанк-обёртка таблицы сравнения. Плейсхолдеры `[[+head]]` и `[[+rows]]`.
**&minItems**		| 2																| Минимальное количество товаров для сравнения.
**&maxItems**		| 10															| Максимальное количество товаров для сравнения.
**&formatSnippet**	| -																| Произвольный сниппет для оформления значения параметра товара. Получает имя поля "$field" и его значение "$value". Должен вернуть отформатированную строку "$value".
**&showLog**		| false															| Вывести администратору подробный лог работы сниппета.

Сниппет выбирает и оформляет товары при помощи [pdoTools][1]. Вы можете использовать [общие параметры этой библиотеки][2].

Если в системе установлен [miniShop2][3], то сниппет будет выбирать товары с учетом их дополнительных таблиц, включая изображения галереи.

## Конфигурация сравнения

На вашем сайте могут быть разные типы товаров и, чтобы не создавать 10 разных страниц сравнения, вы можете указать конфигурацию для всех них в одном параметре **&fields**.

Это JSON строка с массивом, содержащим произвольное имя списка и массив сравниваемых полей.
Если вы указываете параметр **&list** у сниппета [addComparison][4], то вы должны указать и массив полей для него при вызове CompareList.
```
[[!addComparison?
	&list_id=`15`
	&list=`mobile`
]]

[[!CompareList?
	&fields=`{"mobile":["price","article","year","vendor.name","memory","cpu","country"]}`
]]
```
Указывать можно как ТВ параметры, так и параметры товаров [miniShop2][3].

Если вы не указываете **&list**, то будет использована конфигурация **default**, прописанная по умолчанию.

## Оформление

Таблица сравнения строится из 6 чанков, которые перечислены в параметрах сниппета.

Обратите внимание, что в чанке **&tplHead** доступны все плейсхолдеры товара, включая выбираемые поля для сравнения.

### Имена параметров (полей товара)

Все имена параметров выводятся через системный лексикон. То есть, для поля `price` в системе есть запись `comparison_field_price`, для weight - `comparison_field_weight` и т.д.

Если вы указываете параметры, для которых нет записей в лексиконе - нужно добавить их самостоятельно.
Например, если вы сравниваете по ТВ параметру `date`, то нужно добавить в словари `comparison_field_date`.

### Значения параметров

Для оформления внешнего вида значений параметров (цена, вес, артикул и т.д.) вы можете указать произвольный **&formatSnippet**.
Он должен принять название обрабатываемого поля, полученное значение из БД, и выдать в оформленном виде.

Пример такого сниппета:
```
<?php
// Получаемые массивы нужно преобразовать в строку, иначе вы получите слово Array, вместо значения
if (is_array($value)) {
	natsort($value);
	$value = implode(',', $value);
}

// Форматирование цены и веса товаров miniShop2
if ($miniShop2 = $modx->getService('minishop2')) {
	switch ($field) {
		case 'price':
			$value = $miniShop2->formatPrice($value) . ' ' . $modx->lexicon('ms2_frontend_currency');
			break;
		case 'weight':
			$value = $miniShop2->formatWeight($value) . ' ' . $modx->lexicon('ms2_frontend_weight_unit');
			break;
	}
}

// Возвращаем значение
return $value;
```

Также для **&tplCell** добавляется CSS класс с именем параметра и префиксом `field-`.
Например, для цены добавляется CSS класс `field-price`, который по умолчанию выводится жирным текстом.

[1]: /ru/01_Компоненты/01_pdoTools/
[2]: /ru/01_Компоненты/01_pdoTools/04_Общие_параметры.md
[3]: /ru/01_Компоненты/02_miniShop2/
[4]: /ru/01_Компоненты/12_Comparison/01_addComparison.md
