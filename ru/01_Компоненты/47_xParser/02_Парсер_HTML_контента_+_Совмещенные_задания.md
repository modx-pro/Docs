Прежде всего стоит прочесть [о настройке задания для RSS лент][1]. Там основная суть работы компонента.

## Совмещение заданий

С версии 1.2.0 компонент умеет совмещать задания. Например, вам нужно распарсить RSS ленту и каждую запись выпилить с сайта полностью. Для этого:

1. Создаётся пара заданий (первое — RSS, второе — HTML),
2. Настраивается,
3. Запускается.

Ниже разберемся подробнее, как и что нужно делать для совмещения заданий.

## Парсинг HTML контента

Так как в RSS ленте у нас, по-умолчанию, присутствует некий массив полей, которые можно распределить по полям MODX, то в HTML дела обстоят несколько сложнее: нам нужно самим создать эти поля, указав селектор до каждого из них.
Давайте на примере **MODX.pro** рассмотрим, как это делается:

### Добавление заданий

Покажу пример, в котором происходит запуск одного задания из другого. Для этого нам надо будет создать 2 задания:

#### Добавление primary задания

Primary заданием я называю список новостей, которые нам необходимо распарсить.

Жмём "Добавить HTML задание". На вкладке "Основное" заполняем примерно так:

[![](https://file.modx.pro/files/c/d/b/cdb54b4b49d9bdd467620fce36b1197as.jpg)](https://file.modx.pro/files/c/d/b/cdb54b4b49d9bdd467620fce36b1197a.png)

Переключаемся на вкладку "Конфигурация", где указываем:

* Селектор записи (пока только CSS-подобный синтаксис),
* С какой по счёту записи стартовать,
* Сколько записей парсить,
* Шаблон для создаваемых ресурсов,
* Контекст,
* Родительский контейнер в пределах выбранного контекста,
* Скачивать ли медиа-контент.

[![](https://file.modx.pro/files/d/d/6/dd6ef85bd35de1981a93c157af687fbbs.jpg)](https://file.modx.pro/files/d/d/6/dd6ef85bd35de1981a93c157af687fbb.png)

Жмём "Сохранить" - задание добавлено!

#### Добавление secondary задания

Secondary заданием я называю задание, с настройкой парсинга для полной статьи. Его мы будем указывать в качестве наследника для первого задания.

Жмём "Добавить HTML задание". На вкладке "Основное" заполняем примерно так:

[![](https://file.modx.pro/files/e/9/1/e91f7ffe1b781107e7c1dbf89628c44as.jpg)](https://file.modx.pro/files/e/9/1/e91f7ffe1b781107e7c1dbf89628c44a.png)

##### Важно указать:

* **URL** - ссылку на какую-нибудь статью с modx.pro (потребуется для настройки полей источника),
* Поставить галочку **Является подзадачей**.

Переключаемся на вкладку "Конфигурация", где указываем:

* **Селектор записи** = `#content`

### Настройка источника

Так как задания у нас типа HTML, то придётся вручную создавать данные источника, которые будем парсить. Потребуется сделать это для обоих заданий.

Жмём на задании правой мышью => "Источник".

#### Настройка источника для primary задания

Здесь достаточно добавить всего 1 поле - ссылку на полную версию статьи. Однако, я предлагаю добавить ещё и поле `content`, в котором будет храниться *вступительная часть статьи*. В этом вступительном тексте также указывается основное изображение статьи, вот его то мы и будем выдирать с помощью регулярки. Происходить это будет на шаге *Настройки полей primary задания*.

Жмём "Добавить". Здесь у нас есть возможность указать CSS-подобный или XPath синтаксис. Для разных полей часто требуется и тот, и другой.

_**Внимание**: XPath синтаксис имеет неприятный баг: не понимает названия тегов, поэтому приходится указывать тег, как `*`._

Заполняем примерно так:

[![](https://file.modx.pro/files/d/c/3/dc38d54e4946571622461392e2d2368fs.jpg)](https://file.modx.pro/files/d/c/3/dc38d54e4946571622461392e2d2368f.png)
[![](https://file.modx.pro/files/3/3/7/337516ec293102820a6daac7db844b45s.jpg)](https://file.modx.pro/files/3/3/7/337516ec293102820a6daac7db844b45.png)

Там же можно проверить, насколько корректно парсер получает указанные нами значения. Для этого требуется нажать на кнопку с глазом: ![](https://file.modx.pro/files/8/7/4/8741e8d3cfae46ed929bb7587642913f.png)

#### Настройка источника для secondary задания

Тут мы добавляем, также, 2 поля:

##### Pagetitle:

* **Синтаксис** = `CSS`
* **Ключ** = `pagetitle`
* **Селектор** = `h3.page-title`

##### Content:

* **Синтаксис** = `CSS`
* **Ключ** = `content`
* **Селектор** = `.page-content`

### Настройка полей задания

По большому счёту тут всё очень похоже на [настройку RSS задания][1], т.к. у нас уже есть данные из источника, которые можно просмотреть в виде распечатанного массива, кликнув по кнопке "Массив сырых значений".

Сейчас нам надо, опираясь на эти ключи и значения источника, правильно добавить поля для парсинга. Жмём на задании правой мышью => "Поля".

_Описывать подробно возможности пакета на данном этапе не буду, кому интересно, [может почитать это в описании настройки RSS заданий][1]._

#### Настройка полей primary задания

Здесь тоже достаточно одного поля `link`, но мы добавим и поле с основным изображением поста. Выдернем это изображение из вступительной части статьи с помощью Fenom и регулярного выражения.

Жмём "Добавить".

##### Link:

* **Системное поле** = _пусто_
* **Поле в источнике** = `link`
* **Значение по-умолчанию** = _пусто_

##### Introtext: (запишем сюда изображение)

* **Системное поле** = `resource | introtext`
* **Поле в источнике** = `@INLINE {$content | preg_get : '!https?://.+\.(?:jpe?g|png|gif)!Ui'}`
* **Значение по-умолчанию** = _пусто_

Теперь, в таблице добавленных полей задания, у поля `link`, кликаем на звезду (поле должно стать оранжевым) и на соседнюю кнопку. Откроется окошко добавления связанного задания. Там есть сноска, продублирую:

> 1) Убедитесь, что выбранное поле действительно является ссылкой.
> 2) При парсинге эта ссылка будет передана в задание, которое вы выбрали ниже.
> 3) Из выбранного задания будут получены все поля для создания объекта.
> 4) Полученные поля перезапишут аналогичные поля из текущего задания.

В поле "Принимающее задание" выбираем наше secondary задание. Таким образом, primary задание передаст УРЛ из поля `link` в secondary задание.

Жмём "Сохранить".

Поле `link` в таблице подсветится синим цветом:

[![](https://file.modx.pro/files/6/d/2/6d2b9a9c9d3b06f2dec962c7c480ddc1s.jpg)](https://file.modx.pro/files/6/d/2/6d2b9a9c9d3b06f2dec962c7c480ddc1.png)

#### Настройка полей secondary задания

Тут добавляем 3 поля:

##### Pagetitle:

* **Системное поле** = `resource | pagetitle`
* **Поле в источнике** = `@INLINE {$pagetitle | preg_replace : '! \<sup class.*!ui'}`
* **Значение по-умолчанию** = _пусто_

##### Content:

* **Системное поле** = `resource | content`
* **Поле в источнике** = `content`
* **Значение по-умолчанию** = _пусто_

##### Published:

* **Системное поле** = `resource | published`
* **Поле в источнике** = _пусто_
* **Значение по-умолчанию** = `1`

Сохраняем!

[1]: /ru/01_Компоненты/47_xParser/01_Парсер_RSS_лент.md
