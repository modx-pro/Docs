Страница для создания поискового индекса.

Построение индекса — это тяжелая операция, поэтому она разбивается на множество запросов, которые отправляются через Ajax в цикле.

[![](http://st.bezumkin.ru/files/2/a/8/2a867ea2bd861e014cbae3711bf45321s.jpg)](http://st.bezumkin.ru/files/2/a/8/2a867ea2bd861e014cbae3711bf45321.png)

Вы можете указать, по сколько ресурсов за раз нужно индексировать ваш сайт. 10 ресурсов - оптимальное значение. Однако, если вы получаете ошибку timeout, уменьшите это число.

В зависимости от системных настроек из БД извлекаются нужные колонки ресурсов, комментарии и разбиваются на слова.
Затем по каждому слову генерируются словоформы, при помощи [phpMorphy][1] и сохраняются в таблицу индекса.

## Системные настройки

 Название					| По умолчанию			| Описание
----------------------------|-----------------------|-----------------------------
mse2_index_comments			| true					| Включить индексирование комментариев компонента **Tickets**
mse2_index_comments_weight	| 1						| Поисковый вес слова, встречающегося в комментарии
mse2_index_fields			| content:3,description:2,introtext:2,pagetitle:3,longtitle:3	| Настройка индексирования полей ресурса. Имя поля и его поисковый вес через двоеточие
mse2_index_min_words_length	| 4						| Минимальная длина слова для участия в поиске

Самым важным параметром является **mse2_index_fields**, именно он определяет, какую ценность представляют слова в разных полях документа.

## Логика работы
Запись в таблице состоит из самого слова, его веса, который вы указываете в настройках, и ссылки на ресурс, где оно встречается.

Благодаря специальному алгоритму, можно индексировать необычные поля документов, например свойства товаров miniShop2, просто указав их в настройках наравне со всеми.
Также mSearch2 умеет индексировать комментарии **Tickets**, соответствующая настройка включена по умолчанию.

Таким образом, весь ваш сайт разбивается на тысячи вариантов слов, по которым и будет происходить поиск.
В индекс попадают только те документы, у которых отмечен параметр **searchable** — то есть, они "Участвует в поиске".

Благодаря плагину, входящему в комплект, вам не нужно следить за актуальностью индекса — он делает всё сам, в полном соответствии с системными настройками, срабатывая на событие **OnDocFormSave**.

Генерировать поисковый индекс в админке нужно ровно в двух случаях:

* При первой установке компонента
* При изменении системных настроек, отвечающих за индексацию

[1]: http://phpmorphy.sourceforge.net/dokuwiki/