# mspWebPay

## Начало работы

[Скачать модуль mspWebPay][1] можно в Магазине MODX Дополнений Simple Dream.

Для того, чтобы принимать оплату с помощью WebPay, Вам необходимо сначала подать заявку на [регистрацию в системе][2].

Помощь по интеграции модуля оплаты на сайт вы можете получить через [службу технической поддержки][3] либо напрямую у [разработчика в Минске][4].

## Настройка WebPay

_**Важно! Для проверки механизма платежей пользуйтесь только тестовым окружением.**_

Для успешной работы с платежной системой вам понадобится логин и пароль, выданные после регистрации. Для начала необходимо зайти в панель управления и произвести первичную настройку системы.

[![](https://file.modx.pro/files/0/8/7/0877eabcfb0e0a6be961fceb9c3e075bs.jpg)](https://file.modx.pro/files/0/8/7/0877eabcfb0e0a6be961fceb9c3e075b.png)

**Биллинг ID** понадобится при настройке компонента в админ-панели MODX. Его нужно запомнить или записать. Остальные поля вы должны заполнить в соответствии с требованиями формы.

[![](https://file.modx.pro/files/7/f/6/7f627f04c32accfd37826a501f81fe96s.jpg)](https://file.modx.pro/files/7/f/6/7f627f04c32accfd37826a501f81fe96.png)

На данном этапе нужно настроить SMTP-сервер для рассылки уведомлений об оплате вашим клиентам. Логин и пароль такие же, как и от панели управления.

Так же вы можете задать язык сайта оплаты по умолчанию (можно переопределить через настройку в MODX).

**Важный пункт — Секретный ключ**. Его нужно придумать самому максимально сложным и сохранить. Его нужно так же запомнить или записать, так как он понадобится при настройке компонента в админ-панели MODX.

Остальные поля заполняются в соответствии с собственными пожеланиями.

[![](https://file.modx.pro/files/c/5/1/c51589d5ead88baa518650bf3893bce1s.jpg)](https://file.modx.pro/files/c/5/1/c51589d5ead88baa518650bf3893bce1.png)

На этом базовую настройку WebPay можно считать завершенной. Для более тонкой настройки панели обратитесь к руководству по работе с WebPay, выданном вместе с реквизитами доступа или запросите в службе технической поддержки WebPay.

## Установка и настройка пакета в MODX

При установке необходимо ввести реквизиты для начала работы с платежной системой WebPay в MODX.

[![](https://file.modx.pro/files/2/3/c/23c20d07a2a3a8472e532b65a37ca3a6s.jpg)](https://file.modx.pro/files/2/3/c/23c20d07a2a3a8472e532b65a37ca3a6.png)

1. Идентификатор магазина — это тот самый Биллинг ID, который было необходимо запомнить.
2. Логин в системе WebPay — логин от панели управления WebPay, выданный после регистрации.
3. Пароль в системе WebPay — пароль от панели управления WebPay, выданный после регистрации.
4. Секретный ключ — придуманный вами сложный ключ, сохраненный в панели управления WebPay.

Можно пропустить этот шаг и заполнить эти данные позже в системных настройках.
Так же не забудьте после установке включить метод оплаты в настройках miniShop2 и добавить его к необходимому методу доставки.

[![](https://file.modx.pro/files/1/0/6/106349bf172c7db3bc2c449f8f014006s.jpg)](https://file.modx.pro/files/1/0/6/106349bf172c7db3bc2c449f8f014006.png)
[![](https://file.modx.pro/files/8/9/5/895eec0bf866bccf10c1caf12f1524d4s.jpg)](https://file.modx.pro/files/8/9/5/895eec0bf866bccf10c1caf12f1524d4.png)

Чтобы перевести режим оплат из тестового в «боевой», измените системную настройку ms2_payment_webpay_developer_mode с «Да» на «Нет».

[![](https://file.modx.pro/files/9/5/8/958ad4df0aa487ae40f5ad72f10e195ds.jpg)](https://file.modx.pro/files/9/5/8/958ad4df0aa487ae40f5ad72f10e195d.png)

## Справочник по системным настройкам

| Ключ                                  | Название                                | Значение по умолчанию | Описание                                                                                                                                                                                                                                                                                                                                                      |
| ------------------------------------- | --------------------------------------- | --------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **ms2_payment_webpay_version**        | Версия формы оплаты                     | 2                     | На текущий момент всегда используется версия 2, менять не нужно                                                                                                                                                                                                                                                                                               |
| **ms2_payment_webpay_login**          | Логин в системе WebPay                  |                       | Тот самый логин, который вам выдали при регистрации в системе WebPay                                                                                                                                                                                                                                                                                          |
| **ms2_payment_webpay_password**       | Пароль в системе WebPay                 |                       | Его вам тоже выдали вместе с логином. Оба параметра используются для запросов проверки платежа после совершения оплаты покупателем.                                                                                                                                                                                                                           |
| **ms2_payment_webpay_secret_key**     | Секретный ключ                          |                       | Задается в панели управления WebPay. С помощью него подписываются запросы оплаты и осуществляется проверка платежей. Важно придумать его посложнее, чтобы нельзя было подделать ответ от платежной системы.                                                                                                                                                   |
| **ms2_payment_webpay_store_id**       | Идентификатор магазина в системе WebPay |                       | ID вашего магазина. Если укажете не свой, платить будут не вам. Всегда написан в панели управления WebPay.                                                                                                                                                                                                                                                    |
| **ms2_payment_webpay_currency**       | Предлагаемая валюта платежа             | _BYR_                 | В тестовом режиме оплата доступна только в белорусских рублях. При заключении договора вы можете выбрать необходимую валюту и указать здесть в виде кода валюты по [ISO 4217][5]                                                                                                                                                                              |
| **ms2_payment_webpay_language**       | Язык WebPay                             | _russian_             | В системе WebPay доступны только 2 языка, русский и английский, соответственно значение можно задать либо russian либо english                                                                                                                                                                                                                                |
| **ms2_payment_webpay_checkout_url**   | Адрес для выполнения запросов           | _secure.webpay.by_    | Адрес, на который будут отправляться покупатели для оплаты. Как правило менять не нужно.                                                                                                                                                                                                                                                                      |
| **ms2_payment_webpay_gate_url**       | Адрес для выполнения проверки платежа   | _billing.webpay.by_   | Адрес, на который будут отправляться запросы для проверки платежа. Менять тоже не нужно, как правило.                                                                                                                                                                                                                                                         |
| **ms2_payment_webpay_developer_mode** | Режим совершения тестовых платежей      | _Да_                  | В данном режиме все запросы для оплаты и проверки платежа высылаются на специальные тестовые адреса WebPay. Если выключить настройку, то оплаты будут проводиться в боевом режиме. Выключайте ее только после того, как все протестировали и получили ответ от службы технической поддержки WebPay о том, что магазин переведен из тестового в рабочий режим. |
| **ms2_payment_webpay_success_id**     | Страница успешной оплаты WebPay         | _0_                   | Страница, куда будет отправлен покупатель после успешной оплаты. Рекомендуется указывать id страницы с корзиной.                                                                                                                                                                                                                                              |
| **ms2_payment_webpay_failure_id**     | Страница отказа от оплаты WebPay        | _0_                   | Страница, куда будет отправлен покупатель после отказа от оплаты. Рекомендуется указывать id страницы с корзиной.                                                                                                                                                                                                                                             |

[1]: https://store.simpledream.ru/packages/ecommerce/mspwebpay.html
[2]: http://reg.webpay.by/registration-form.php
[3]: https://store.simpledream.ru/cabinet/tickets/
[4]: http://klimchuk.by/about.html
[5]: http://www.iso.org/iso/home/standards/currency_codes.htm
