# Настройки miniShop2

Настройки miniShop2 находятся в отдельном разделе сайта, доступном через меню.

Все таблицы запоминают настройки ширины и положения колонок.
Везде работает множественное выделение строк через Ctrl(Cmd) или Shift.

## Доставка

[![](https://file.modx.pro/files/0/3/d/03d43063bc5f0c15e2b59e7c75c646fbs.jpg)](https://file.modx.pro/files/0/3/d/03d43063bc5f0c15e2b59e7c75c646fb.png)

Вы можете создавать разные методы доставки со своей логикой, за которую будет отвечать [кастомный класс][1], указанный в настройках.
Класс необязателен, вы можете его не указывать и тогда никакой особой обработки заказа не будет.

[![](https://file.modx.pro/files/e/d/5/ed56f7ddd5f45402442370885078d8a1s.jpg)](https://file.modx.pro/files/e/d/5/ed56f7ddd5f45402442370885078d8a1.png)

Каждому методу доставки привязываются свои методы оплаты в окне редактирования.

[![](https://file.modx.pro/files/4/0/1/401f530864705bedb8bacb417db211das.jpg)](https://file.modx.pro/files/4/0/1/401f530864705bedb8bacb417db211da.png)

## Оплата

[![](https://file.modx.pro/files/c/6/c/c6c4bb3c3a12ef7d3e94e15270eb59c8s.jpg)](https://file.modx.pro/files/c/6/c/c6c4bb3c3a12ef7d3e94e15270eb59c8.png)

Методы оплаты привязываются к заказам и должны реализовывать какую-то свою логику.
Обычно они отправляют пользователя для оплаты заказа на сторонний сервис.

[![](https://file.modx.pro/files/c/a/0/ca0834e0e7b9154a9ae99593258bb400s.jpg)](https://file.modx.pro/files/c/a/0/ca0834e0e7b9154a9ae99593258bb400.png)

Указание [класса-обработчика оплаты][6] необязательно.

## Статусы заказа

[![](https://file.modx.pro/files/d/9/9/d992c108a175a6a63f20430d7a733725s.jpg)](https://file.modx.pro/files/d/9/9/d992c108a175a6a63f20430d7a733725.png)

Существует несколько обязательных статусов заказа:

* новый
* оплачен
* отправлен
* отменён"
Их можно настраивать, но нельзя удалять, так как они необходимы для работы магазина.
Вы можете указать свои статусы для расширенной логики работы с заказами в [своём классе][2].

Статус может быть **окончательным**. Это значит, что его нельзя переключить на другой.
Например, "отправлен" и "отменён".

Статус может быть **зафиксирован**. То есть, с него нельзя переключаться на более ранние статусы (порядок задаётся перетаскиванием).
Например, "оплачен" нельзя переключить на "новый".

[![](https://file.modx.pro/files/3/b/d/3bd18550d15892a08eca767daa51036ds.jpg)](https://file.modx.pro/files/3/b/d/3bd18550d15892a08eca767daa51036d.png)

Каждый статус может отправлять свои письма покупателю и администраторам магазина, указанным в системной настройке **ms2_email_manager**.

Для оформления писем используются указанные в статусе чанки.
Все они обрабатываются [pdoTools][3], так что вы можете использовать [Fenom][4] для наследования одного общего шаблона писем.

## Производители

[![](https://file.modx.pro/files/c/b/5/cb518b8ffa89e7aec3f4d794106b7f44s.jpg)](https://file.modx.pro/files/c/b/5/cb518b8ffa89e7aec3f4d794106b7f44.png)

В этом разделе вы можете задать производителей товаров, которые потом будут выбираться в свойствах товара.

[![](https://file.modx.pro/files/c/e/2/ce250f7e7270ba124ecb10c2da71fa70s.jpg)](https://file.modx.pro/files/c/e/2/ce250f7e7270ba124ecb10c2da71fa70.png)

Каждому производителю можно указать разные свойства и связь с ресурсом сайта, например, для вывода его персональной страницы.

## Связи товаров

Это простой инструмент, который позволяет создавать группы товаров по любому признаку.

[![](https://file.modx.pro/files/3/d/1/3d1110c391487d2eb6142a90b8abd1das.jpg)](https://file.modx.pro/files/3/d/1/3d1110c391487d2eb6142a90b8abd1da.png)

Типы связи нужно выбрать из четырех доступных:

* **Один к одному** - двухстороння равная связь товаров.
* **Один ко многим** - связь одного товара с несколькими. Дочерние товары не связаны друг с другом, только с родителем.
* **Многие к одному** - тоже самое, что и предыдущая связь, только наоборот - дочерний товар связывается с главным. Возможно, этот тип избыточен, но пусть будет для симметрии.
* **Многие ко многим** - самый интересный тип связи - равнозначная многосторонняя связь нескольких товаров, при добавлении в группу нового товара он связывается со всеми ее членами.
Эта связь нужна для указания товаров, которые отличаются, например, по одному параметру.
Или все товары этой группы могут быть участниками какой-то акции (и вы легко сделаете вывод ссылок на другие предложения на странице товара).

[![](https://file.modx.pro/files/0/a/8/0a8e6b14d03e9cd7aeac8a7f671de6b4s.jpg)](https://file.modx.pro/files/0/a/8/0a8e6b14d03e9cd7aeac8a7f671de6b4.png)

### Хранение

Для добавления новой записи нужно выбрать заранее созданную связь и товар, к которому ее применить.

[![](https://file.modx.pro/files/5/7/e/57e122559c34bd8cbb1c3e30963d0a87s.jpg)](https://file.modx.pro/files/5/7/e/57e122559c34bd8cbb1c3e30963d0a87.png)

На уровне базы данных связанность товаров представляет таблица **msProductLink**, в которой всего 3 столбика:

* **link** - то есть id связи в таблице `msLink`, которую мы создали чуть выше, в настройках
* **master** - это id главного товара
* **slave** - а это id подчиненного товара

Давайте разберемся, какие записи создаются у разных типов связей.

**Один к одному** - добавляем товар с id = 10 к товару с id = 15, создаётся 2 записи в БД:

``` plain
master = 10, slave = 15
master = 15, slave = 10
```

**Один ко многим** - добавляем 3 товара с разными id к товару с id = 10, получаем такие записи:

``` plain
master = 10, slave = 15
master = 10, slave = 16
master = 10, slave = 17
```

**Многие к одному** - добавляем 3 товара с разными id к товару с id = 10, получаем такие записи:

``` plain
master = 21, slave = 10
master = 22, slave = 10
master = 23, slave = 10
```

**Многие ко многим** - и, наконец, добавляем 3 товара с разными id к товару с id = 10.

``` plain
master = 10, slave = 31
master = 10, slave = 32
master = 10, slave = 33
master = 31, slave = 10
master = 31, slave = 32
master = 31, slave = 33
master = 32, slave = 10
master = 32, slave = 31
master = 32, slave = 33
master = 33, slave = 10
master = 33, slave = 31
master = 33, slave = 32
```

Все товары группы перелинкованы друг с другом.

### Выборка

Тут всё просто: создаём сниппет и выбираем id товаров группы, указывая **link** и **master** (у связи многие к одному - slave вместо master).

``` php
$q = $modx->newQuery('msProductLink', array(
    'link' => 1,
    'master' => 10
));
$q->select('slave');

if ($q->prepare() && $q->stmt->execute()) {
    $ids = $q->stmt->fetchAll(PDO::FETCH_COLUMN);
    print_r($ids);
}
```

Ну а получив id связанных товаров, можно делать с ними всё, что угодно. Возможности применения ограничены только вашей фантазией.

### Примеры

Разные цвета (несколько копий товаров со своими фотографиями и ценами)

[![](https://file.modx.pro/files/6/2/2/622ed477f81314619ccb842abb89a9d9s.jpg)](https://file.modx.pro/files/6/2/2/622ed477f81314619ccb842abb89a9d9.png)

Рекомендованные товары (выводятся в корзине, при оформлении заказа)

[![](https://file.modx.pro/files/2/7/a/f/7afaeb1b0785680df6bd64466e3fa798_thumb.png)](https://file.modx.pro/files/2/7/a/f/7afaeb1b0785680df6bd64466e3fa798.png)

Комплекты товаров (выводятся ссылки на другие товары комплекта в карточке)

[![](https://file.modx.pro/files/8/5/d/85dc782cee8d7e85dc02770b01cfe849s.jpg)](https://file.modx.pro/files/8/5/d/85dc782cee8d7e85dc02770b01cfe849.png)

## Опции товаров

[![](https://file.modx.pro/files/0/b/1/0b15183d616799496b2a24cec43106c9s.jpg)](https://file.modx.pro/files/0/b/1/0b15183d616799496b2a24cec43106c9.png)

Для создания новой характеристики необходимо нажать кнопку "Создать" и заполнить в появившемся окне дополнительную информацию:

* **Ключ** - идентификатор характеристики в системе, определяющий ее плейсхолдер на фронтэнде. Обязательно к заполнению.
* **Название** - отображаемый заголовок характеристики.
* **Описание**
* **Единица измерения**
* **Группа** - категория в системе MODX, будет выводиться в табе на странице опций товара
* **Тип свойства** - определяет допустимый формат заполнения значения

Вы можете фильтровать уже созданные характеристики при помощи дерева категорий товаров, расположенной в левой части страницы.
Также при создании характеристики можно сразу определить ее к соответствующим категориям товаров, выбрав их при помощи дерева слева.

[![](https://file.modx.pro/files/e/c/6/ec68f57c854c4a7f0057c94d85ba62d0s.jpg)](https://file.modx.pro/files/e/c/6/ec68f57c854c4a7f0057c94d85ba62d0.png)

Созданные характеристики товаров отображаются на [странице товара][5] в соответствующей вкладке.

Для вывода опций товара нужно использовать сниппет [msProducts][7].

[1]: /ru/01_Компоненты/02_miniShop2/03_Разработка/03_Службы/03_Доставка.md
[2]: /ru/01_Компоненты/02_miniShop2/03_Разработка/03_Службы/02_Заказ.md
[3]: /ru/01_Компоненты/01_pdoTools
[4]: /ru/01_Компоненты/01_pdoTools/03_Парсер.md
[5]: /ru/01_Компоненты/02_miniShop2/01_Интерфейс/02_Товар.md
[6]: /ru/01_Компоненты/02_miniShop2/03_Разработка/03_Службы/04_Оплата.md
[7]: /ru/01_Компоненты/02_miniShop2/02_Сниппеты/01_msProducts.md
