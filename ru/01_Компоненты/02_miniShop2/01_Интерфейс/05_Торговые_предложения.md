Начиная с версии 2.3 появилась возможность добавлять торговые предложения, которые представляют из себя зависимые связи между выбранными характеристиками товара и его итоговой ценой.

## Административная часть
В административной части сайта, на странице товара добавлена новая закладка "Торговые предложения". Изначально она содержит один набор данных, соответствующий состоянию товара по умолчанию.

**Важно:** Теперь у одного товара msProduct может быть несколько наборов данных msProductData. Их принадлежность к товару выглядит как msProduct.id=msProductData.sku_id, где sku_id - уникальный ключ для группы данных.

[![](https://file.modx.pro/files/6/d/6/6d63c33be72c8ed5cdcef47b524662fes.jpg)](https://file.modx.pro/files/6/d/6/6d63c33be72c8ed5cdcef47b524662fe.jpg)

Выводимые столбцы в таблице торговых предложений назначаются в системной настройке **ms2_product_sku_grid_fields**.  
Также в каждой категории товаров к ним добавляются столбцы с назначенными ей характеристиками товаров (по умолчанию выводятся скрытыми).

Вы также можете указать отдельные изображение для конкретного торгового предложения, нажав пкм по желаемому предложению и выбрав пункт "Открыть галерею". 

### Создание нового торгового предложения
Создать новое торговое предложение можно как вручную, так и воспользовавшись "генератором торговых предложений".  

#### Создание торговых предложений вручную

Нажав кнопку "Создать", откроется окно для создания нового торгового предложения. В нем будут отображены дефолтные свойства товаров, его характеристики и уникальное название для данного торгового предложения.  

При нажатии на кнопку "Свойства" будет отображен список доступных полей и свойств товара, при выборе которых в название торгового предложения будут добавлены соответствующие плейсхолдеры. При сохранении торгового предложения плейсхолдеры будут заменены на значение выбранных свойств.

[![](https://file.modx.pro/files/6/c/9/6c9e62aa6939c447c70369b1a76b056bs.jpg)](https://file.modx.pro/files/6/c/9/6c9e62aa6939c447c70369b1a76b056b.jpg)

#### Генератор торговых предложений

Нажав кнопку "Генерировать торговые предложения", откроется схожее с созданием окно, в котором также доступна таблица со списком всех заполненных вариантов свойств товара.

Выбрав требуемые для генерации варианты свойств, будут сформированы торговые предложения со всеми возможными сочетаниями этих вариантов.

[![](https://file.modx.pro/files/f/2/d/f2dbcfd54198d60994f22dcda6d9c5c3s.jpg)](https://file.modx.pro/files/f/2/d/f2dbcfd54198d60994f22dcda6d9c5c3.jpg)

## Фронтенд

Поскольку отношение между товаром msProduct и его данными msProductData изменились с "один-к-одному" на "один-ко-многим", то сниппет **msProducts** по умолчанию будет возвращать все доступные варианты. 
 
При необходимости, вы можно вывести только общие товары, указав параметре **&where=`{"Data.default":1}`**.
