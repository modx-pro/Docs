# mscDistance

Компонент реализует расчет стоимости доставки по городу (району) в зависимости от величины пути доставки.

## Описание компонента

[![](https://file.modx.pro/files/e/b/d/ebd480eb609e7499251e00d6780eb9a9s.jpg)](https://file.modx.pro/files/e/b/d/ebd480eb609e7499251e00d6780eb9a9.png)

* Координаты склада - координаты склада в формате `57.987211,56.252048`
* Город доставки - указать город в пределах которого осуществляется доставка товаров
* Регион доставки - указать регион в пределах которого осуществляется доставка товаров
* Улица, дом доставки - улица, дом от которого идет расчет доставки, фактически адрес склада

[![](https://file.modx.pro/files/8/8/1/881cd358535ea5f555a645fb2ae0d82ds.jpg)](https://file.modx.pro/files/8/8/1/881cd358535ea5f555a645fb2ae0d82d.png)

* Язык возвращаемых ответов - язык на котором следует возвращать ответ
* Система измерений - возвращает расстояние в километрах / метрах (метрическая - metric) или в милях / футах (имперская - imperial)

[![](https://file.modx.pro/files/2/3/2/232e447c3dc9461a680f0f2708acb69ds.jpg)](https://file.modx.pro/files/2/3/2/232e447c3dc9461a680f0f2708acb69d.png)

* Объем товара по умолчанию - объем товара [miniShop2][1] для которого не задан размер
* Поправочный коэф-т - возможно ввести некую корректировку объема ( объем = объем * коэф-т )

[![](https://file.modx.pro/files/7/9/4/794b29fc1caacb5310c7897e2bcec655s.jpg)](https://file.modx.pro/files/7/9/4/794b29fc1caacb5310c7897e2bcec655.png)

* Разделитель размера товара - символ разделитель в поле `size` [miniShop2][1]
* Единицы измерения размера товара - доступны `мм` и `см`

[![](https://file.modx.pro/files/4/f/7/4f773bb503926406a86d2ab205dd2460s.jpg)](https://file.modx.pro/files/4/f/7/4f773bb503926406a86d2ab205dd2460.png)

* Максимальная дистанция на которую осуществляется доставка, указывается в метрах (футах)
* Максимально допустимый объем доставки
* Максимально допустимый вес доставки

[![](https://file.modx.pro/files/8/8/1/881cc8755d2da537948e642009c229b1s.jpg)](https://file.modx.pro/files/8/8/1/881cc8755d2da537948e642009c229b1.png)

* Минимальная плата за доставку, активна при расчете меньшей стоимости доставки
* Тарифная сетка - указывается в формате json. Например - `{"5":10,"10":15,"15":20}`

## Основные настройки

### В miniShop2 :: Настройки :: Варианты доставки

* Активировать вариант доставки
* Назначить необходимые варианты оплаты

[![](https://file.modx.pro/files/4/7/c/47c6182a863b3fe0ee50c980dc082de8s.jpg)](https://file.modx.pro/files/4/7/c/47c6182a863b3fe0ee50c980dc082de8.png)

### Настройки системы :: miniShop2

* Класс обработчик заказа - `mscdOrderHandler`
* Класс обработчик корзины - `mscdCartHandler`

## Сниппет msOrderDistance

Практически близнец сниппета [msOrder][2]. Параметры:

* tplOuter - Обёртка для вывода результатов работы сниппета
* tplPayment - Чанк для оформления метода оплаты
* tplDelivery - Чанк для оформления способа доставки
* tplEmpty - Чанк, который выводится при отсутствии результатов
* tplSuccess - Чанк с сообщением об успешной работе сниппета
* front_js - Скрипт фронтенда
* front_css - Скрипт фронтенда
* region_on - Автоподстановка региона доставки ДА/НЕТ
* city_on - Автоподстановка города доставки ДА/НЕТ

## Чанк tpl.msOrder.Distance.outer

Стандартный чанк вывода + вывод инфо о доставке + построение карты маршрута

[![](https://file.modx.pro/files/2/5/1/251f00bfc8d58246d30b4a13752662e0s.jpg)](https://file.modx.pro/files/2/5/1/251f00bfc8d58246d30b4a13752662e0.png)

## Необходимо:

Для правильного расчета стоимости доставки товара

* Каждому товару задать размер
* Каждому товару задать вес

## Тарифная сетка - пример расчета

Если не указана тарифная сетка, стоимость доставки = величина пути * Стоимость ед/рст.
Если указана тарифная сетка, например - `{"5":10,"10":15,"15":20}` то расчет стоимости идет следующим образом:
Допустим величина пути = 11км, `стоимость доставки = 5 * 10 + 5 * 15 + 1 * 20 = 145 руб`.

[1]: /ru/01_Компоненты/02_miniShop2/
[2]: /ru/01_Компоненты/02_miniShop2/02_Сниппеты/03_msOrder.md
