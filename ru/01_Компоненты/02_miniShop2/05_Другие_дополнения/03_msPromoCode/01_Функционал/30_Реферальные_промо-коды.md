# Реферальные промо-коды

Можно раздать пользователям купоны со скидкой для привлечения друзей и знакомых.

Что делать после привязки реферального купона к оформленному заказу, решаете вы сами. Для этого есть событие плагина `mspcOnBindCouponToOrder`. [Здесь есть пример плагина][1], который поможет разобраться, как навесить свой функционал после создания заказа с реферальным купоном.

## Инструкция по настройке

1. Создаём акцию с галочкой `Реферальная`.

2. Переходим на вкладку `Купоны` и жмём `Генерировать`. Таким образом мы сгенерируем для каждого юзера по промо-коду, которым он впоследствии сможет пользоваться для привлечения рефералов.

3. На странице профиля или там, где надо вывести данные о купоне юзера-реферрера, вызываем сниппет `mspcRefCoupon`. Можно воспользоваться постраничной навигацией и вывести список заказов для данного промо-кода постранично:

```html
[[!pdoPage?
    &element=`mspcRefCoupon`
    &limit=`2`
]]
[[!+page.nav]]
```

Можно убрать вывод списка заказов, просто исключив его из шаблона `tpl`:

```html
[[!mspcRefCoupon
    &tpl=`@INLINE <p><b>Код реферального промо-кода</b>: {$coupon}</p><p><b>Количество применений</b>: {$orders_count}</p>`
]]
```

Теперь, когда юзер зайдёт на страницу профиля, он увидит что-то вроде этого:
[![](https://modx.pro/assets/images/tickets/8679/29bb0e01740286c0e37904d37ff37c0f080a3144.png)](https://modx.pro/assets/images/tickets/8679/29bb0e01740286c0e37904d37ff37c0f080a3144.png)

Внешний вид настраивается в параметрах `tpl` и `tplOrder`.

## Плейсхолдеры шаблона tpl

* `coupon` — код купона
* `coupon_id` — id купона
* `orders_count` — кол-во заказов по текущему купону
* `orders` — список заказов, сформированный по шаблону `tplOrder`

## Плейсхолдеры шаблона tplOrder

* `order_id` — id заказа
* `discount_amount` — сумма скидки
* `user_id` — id юзера, совершившего заказ
* `createdon` — дата создания заказа
* `order_num` — номер заказа
* `order_cost` — общая стоимость заказа, вместе с доставкой
* `order_cart_cost` — стоимость заказа, без доставки
* `username` — username покупателя
* `fullname` — fullname покупателя
* `email` — email покупателя
* `phone` — телефон покупателя
* `status_name` — название текущего статуса заказа
* `status_description` — описание текущего статуса заказа

[1]: /ru/01_Компоненты/02_miniShop2/05_Другие_дополнения/03_msPromoCode/10_События_плагинов/180_mspcOnBindCouponToOrder.md
