# msSMS

Компонент предназначен для автоматической отправки SMS-сообщений при оформлении заказов в интернет-магазине. Умеет отправлять сообщения покупателю, менеджеру(ам), покупателю и менеджеру(ам). Срабатывает при изменении статуса заказа, при этом на какие изменения и как реагировать указывается в панели администратора.

После установки компонента для начала работы с ним нужно:

* зарегистрироваться в одном из поддерживаемых сервисов
* на вкладке «Провайдеры» указать параметры подключения к сервису
* на вкладке «События» настроить статусы при установке которых будут отправляться сообщения
* внести средства на счет сервиса рассылки

## Настройка провайдера

Для начала нужно зарегистрироваться в одном из поддерживаемых сервисов для рассылки SMS (если еще не зарегистрированы). После регистрации в кабинете сервиса Вы сможите получить параметры для подключения и работы с API, которые необходимо указать в настройках соответствующего провайдера (в виде JSON закодированной строки). Также нужно сделать его активным, для этого поставте галку в поле «Активный».

[![](https://file.modx.pro/files/3/6/1/3610a66cd497ccb2df74297c38282fc7s.jpg)](https://file.modx.pro/files/3/6/1/3610a66cd497ccb2df74297c38282fc7.png)

Какие параметры нужны для выбранного провайдера можно узнать на его сайте. Для провайдеров, которые предустановлены параметры уже подготовлены, Вам нужно только указать значения.

На данный момент поддерживаются следующие сервисы SMS рассылок:

* [https://www.bytehand.com/](https://www.bytehand.com/)
* [http://letsads.com/](http://letsads.com/)
* [http://www.atompark.com/bulk-sms-service/](http://www.atompark.com/bulk-sms-service/)

## Настройка событий

На вкладке «События» приведен список возможных статусов заказа. Данные для него берутся из соответствующей таблицы miniShop2. Если список пуст, либо Вы изменили/удалили/добавили статус, для синхронизации его (списка) нужно нажать кнопку «Обновить список».

На этой вкладке Вы можете настроить кому и когда будут отправляться сообщения, а также что в них будет содержаться.

Например допускаем ситуацию, когда пользователь Евгений Петров сделал заказ на 1000руб.  Если нужно чтобы при оформлении заказа отправлялось сообщение покупателю с текстом «Вы совершили покупку в интернет-магазине ExempleShop на сумму 1000руб. Номер Вашего заказа 1403/5. Спасибо за покупку!», и отправлялось сообщение менеджерам с  «Пользователь Евгений Петров сделал заказ на сумму 1000руб. Номер заказа 1403/5». Номера менеджеров +7 011 111 11 11 и +7 022 222 22 22. Вам нужно настроить статус «Новый» так как показано на изображении снизу

[![](https://file.modx.pro/files/c/8/a/c8a60187af2d7138186f9da1094afd49s.jpg)](https://file.modx.pro/files/c/8/a/c8a60187af2d7138186f9da1094afd49.png)

Если Вы не хотите отправлять сообщение покупателю — оставьте поле для него пустым, если же нужно отправлять только покупателю а менеджерам — нет, то не указывайте телефоны менеджеров.

В сообщениях можно использовать следующие конструкции {cost}, {order_id}, {order_num}, {customer}, которые будут заменены на данные из заказа — стоимость, id заказа, номер заказа, имя покупателя (receiver) соответственно.

Для отправки сообщения пользователю компонент будет пытаться получить телефон в следующем порядке:

1. из данных введенных пользователем при оформлении заказа
2. из поля mobilephone в профиле
3. из поля phone в профиле

если телефон **не будет определен**, или его формат **не будет соответствовать** требованиям сервиса для рассылки — **сообщение отправлено не будет**.
**Как именно получить от покупателя телефон в нужном формате — это задача которую каждый должен решить самостоятельно.**

## Журнал

На вкладке «Журнал» хранится информация об отправленных сообщениях. В таблице указываются дата, провайдер на сервис которого было отправлено сообщение, тип адресата (менеджер/покупатель), номер телефона адресата, само сообщение, статус который вернул провайдер обработав запрос с Вашего сайта и последний полученный статус сообщения (обычно провайдеры принимают сообщения в очередь, и отправляют в соответствующем порядке). Для получения данных о текущем статусе нужно нажать правой кнопкой мыши на интересующей строке и выбрать пункт «Запросить статус».

У разных провайдеров статусы отличаются, их описание можно найти на сайте провайдера.

У каждого провайдера есть статусы которые являются финальными, тоесть для сообщения с таким статусом уже не может быть повторно запрошен актуальный статус. К таким статусам относятся например статусы доставленного сообщения или сообщения которое было отклонено сервисом из-за ошибки в данных запроса на его отправку (не верный формат номера, оператор адресата не поддерживается сервисом и т. д.).  Если Вы попытаетесь повторно получить статус для такого сообщения, то получите сообщение об ошибке «Status of message has been alredy received». Список таких статусов задается в классах отдельных провайдеров.
