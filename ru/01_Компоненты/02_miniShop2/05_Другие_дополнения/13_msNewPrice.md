# msNewPrice

Компонент реализует новые и акционные цены на товары Minishop2.

## Настройки модуля

Для редактирования настроек скрипта перейдите в раздел "Настройки системы" и выберите фильтр "msnewprice"

[![](https://file.modx.pro/files/8/e/0/8e0ea25a467f2f81f0fedde59354b6d6s.jpg)](https://file.modx.pro/files/8/e/0/8e0ea25a467f2f81f0fedde59354b6d6.png)

* Новые цены товара - включить / выключить
* Акционная цена - включить / выключить (дефолтные настройки на странице товара)
* Перезаписать цену - включить / выключить (дефолтные настройки на странице товара)
* Разрешить отправку писем подписавшимся пользователям - включить / выключить
* Смещение начала новой цены - задать смещение начала новой цены относительно текущего времени в часах.
* Смещение окончания новой цены - задать смещение начала новой цены относительно текущего времени в часах.
* Чанк письма акции на товар
* Чанк письма акции на товар
* Чанк письма новой цены на товар
* Id ресурса отписки от товара

## Вкладка Новая цена

После активации модуля в ресурсе товара Minishop у вас появится новая вкладка 'Новая цена'

[![](https://file.modx.pro/files/d/8/4/d841cdfcc5face3d65dddba0cbd50f3ds.jpg)](https://file.modx.pro/files/d/8/4/d841cdfcc5face3d65dddba0cbd50f3d.png)

Можно выставить новую цену товара, уточнить время действия новой цены, задать описание акции.

## Акционная цена

Логика достаточна проста, выставляете новую стоимость товара, дату начала акции и дату окончания.
В течении указанного периода времени на товар будет действовать акционная цена.
Можно поставить чекбокс — перезаписать цену и родная цена товара [[+price]] будет перезаписана на цену акции после окончания акции.

## Новая цена

Обычное дело для интернет магазина — это смена цен. Можно выставить новую цену на товар и дату начала новой цены. По наступлении указанной даты родная цена товара [[+price]] будет перезаписана.

## Cледить за товаром

Доступна подписка на товар авторизированным пользователям.

[![](https://file.modx.pro/files/8/e/4/8e4f296e3c715e9850b4ed133b0b2aa7s.jpg)](https://file.modx.pro/files/8/e/4/8e4f296e3c715e9850b4ed133b0b2aa7.png)

То есть вы можете подписаться на товар и так же просто отписаться.
В комплекте скрипт набивки писем в очередь при наступлении новой и акционной цены. То есть если пользователю ИМ интересен товар и он подписался на него. Можно отправить ему письмо о смене цены на товар.
Так же в комплекте скрипт на рассылку писем. (работа скрипта по cron)
ps. В принципе можно подписываться так же и на ресурсы и модифицировать рассылку по другим событиям.

## [msNewPrice] сниппет

Служит для вывода информации об акции на товар, стоимости и сроках ее действия, а так же дает возможность подписаться пользователям на товар.

### Параметры сниппета

* product - Идентификатор товара. Если не указан, используется id текущего документа.
* returnNewPrice - Укажите да и сниппет возвратит только новую цену без оформления.
* dateFormat - Формат даты.
* showSubscribe - Выводить или нет блок подписки на товар.
* tplOuter - Обёртка для вывода результатов работы сниппета.
* tplStockInfo - Чанк, вывода информации о акционной цене на товар.
* tplNoStockInfo - Чанк, вывода информации о новой цене на товар.
* tplSubscribe - Чанк, блока ссылок подписки на товар.

## [msNewPriceDelSubscribe] сниппет

Служит для отписки пользователя от рассылки.

### Параметры сниппета

* resSnippet - Сниппет для вывода информации о товаре.
* delSubscribe - Удалить подписку на продукт.
* tplUserInfo - Чанк, вывода информации о пользователе.
* tplNoUserInfo - Чанк, вывода предупреждения пользователь неавторизован. (отписка невозможна)
* tplNotYourResource - Чанк, вывода предупреждения попытки удаления ресурса другого пользователя. (отписка невозможна)

[![](https://file.modx.pro/files/8/f/d/8fd18ba37c2eb2b55b1611b3a1d8900cs.jpg)](https://file.modx.pro/files/8/f/d/8fd18ba37c2eb2b55b1611b3a1d8900c.png)

## Важное!!!

* Замена цены товара на новую.
* Формирование писем пользователям.
* Рассылка писем.

Все вышеперечисленное требует работы скрипта по cron.
Скрипты расположены в папке cron

```php
core/components/msnewprice/cron/
```
