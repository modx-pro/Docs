Модуль интеграции сайта на MODX Revolution и системы amoCRM

# Ключевые особенности и возможности:
* Создание сделок и контактов из любых формы на сайте
* Привязка сделок к существующим контактам в amoCRM
* Автоматические поиск существующих контактов для обновления, создание при отсутствии
* Передача метода оплаты, доставки и списка товаров при создании сделки из заказа
* Двустороннее изменение статусов заказов
* Двустороннее обновление контактов/пользователей
* Из любой формы обратной связи создает контакт и сделку
* Автоматическое создание:
  * Поля заказов
  * Поля контактов 
  * Воронка для заказов
  * Соответствие статусов в amoCRM статусам на сайте
* Обработка данных из amoCRM с помощью вебхука. Из коробки доступно:
  * Обновление/создание пользователей из данных контактов
  * Смена статуса заказа
* Обработка передаваемых и получаемых данных с помощью плагинов
* Определение ответственных, воронок, статусов на основании категорий товаров в заказе
* Указание ответственных, воронок, статусов по умолчанию
* Блокировка отдельных полей контактов amoCRM от изменения с сайта
* Примеры полезных скриптов в каталоге _/core/components/amocrm/examples/_
* Поддержка очереди [simpleQueue][1] для фоновой отправки данных

# Быстрый старт

Для минимальной настройки компонента необходимо заполнить системные настройки:
* **amocrm_account** - Аккаунт. Поддомен домена amocrm.ru
* **amocrm_client_id** - ID интеграции, можно получить в личном кабинете, в разделе интеграции
* **amocrm_client_code** - Код авторизации, можно получить в личном кабинете, в разделе интеграции.  Действует только 20 минут.
* **amocrm_client_secret** - Секретный ключ интеграции можно получить в личном кабинете, в разделе интеграции

## Данные из форм
Заполните две системные настройки
* **amocrm_form_pipeline_id** - Номер воронки в которую планируете отправлять заявки из форм. Можно взять из адресной строки URL
* **amocrm_form_status_new** - ID статуса указанной выше воронки.  Можно посмотреть в инспекторе кода, выделив колонку статуса.

Для отправки данных форм в **amoCRM** используется сниппет _amoCRMAddContact_, который необходимо добавить в качестве
хука при вызове FormIt или AjaxForm. Чтобы правильно передавать поля из форм, добавьте к вызову параметр
_amoCRMmodxAmoFieldsEq_ в следующем формате:
`formField1==amoField1||formField2==amoField2`  
Чаще всего из формы передаются поля phone и email, в таком случае параметр принимает вид:
`phone||email`  
Подробнее о формате и дополнительных параметрах хука смотрите на странице "Отправка данных из форм".  

По умолчанию из форм создаются только контакты. Убедитесь, что в системной настройке **amocrm_user_fields**  указаны
все поля, которые необходимо передавать контактам.

Если требуется создавать сделки, включите системную настройку **amocrm_form_as_lead** и проверьте, что необходимые 
для сделок поля указаны в настройке **amocrm_order_fields**. 

## Заказы miniShop2
Заполните две системные настройки
* **amocrm_pipeline_id** - Номер воронки в которую планируете отправлять заявки из форм. Можно взять из адресной строки URL
* **amocrm_new_order_status_id** - ID статуса указанной выше воронки.  Можно посмотреть в инспекторе кода, выделив колонку статуса.

Для базовой передачи заказов обычно ничего дополнительно не требуется делать. После заполнения системных настроек,
связанных с подключением к amoCRM и указанием необходимых ID, новые заказы сразу отправляются как сделки с привязанными к ним контактами.   

[1]: https://modstore.pro/packages/utilities/simplequeue
