# msGetOrder

Сниппет вывода оформленного заказа.

Используется на странице оформления заказа и отправки почтовых уведомлений покупателям.

## Параметры

| Параметр          | По умолчанию   | Описание                                                                                                                                                                                     |
| ----------------- | -------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **tpl**           | tpl.msGetOrder | Чанк оформления                                                                                                                                                                              |
| **includeTVs**    |                | Список ТВ параметров для выборки, через запятую. Например: "action,time" дадут плейсхолдеры [[+action]] и [[+time]].                                                                         |
| **includeThumbs** |                | Список размеров превьюшек для выборки, через запятую. Например: "120x90,360x240" дадут плейслолдеры [[+120x90]] и [[+360x240]]. Картинки должны быть заранее сгенерированы в галерее товара. |
| **toPlaceholder** |                | Если не пусто, сниппет сохранит все данные в плейсхолдер с этим именем, вместо вывода не экран.                                                                                              |
| **showLog**       |                | Показывать дополнительную информацию о работе сниппета. Только для авторизованных в контекcте "mgr".                                                                                         |

*Можно использовать и другие [общие параметры pdoTools][1]*

## Оформление

Сниппет рассчитывает на работу с [чанком Fenom][2] и передаёт в него 7 переменных:

- **order** - массив с данными заказа из объекта `msOrder`
- **products** - массив заказанных товаров со всеми их свойствами
- **user** - массив данных из объектов `modUser` и `modUserProfile` со всеми свойствами покупателя
- **address** - массив данных из объекта `msAddress` со указанными данными для доставки
- **delivery** - массив со свойствами выбранной доставки из объекта `msDelivery`
- **payment** - массив со свойствами выбранной оплаты из объекта `msPayment`
- **total** - массив с итоговыми данными заказа:
  - **cost** - общая стоимость заказа
  - **weight** - общий вес заказа
  - **delivery_cost** - отдельная стоимость доставки
  - **cart_cost** - отдельная стоимость заказанных товаров
  - **cart_weight** - общий вес заказанных товаров
  - **cart_count** - количество заказанных товаров

*Так же могут присутствовать и данные, переданные при вызове сниппета.
Например, в чанке оформления новых писем может быть переменная `payment_link`*

### Плейсхолдеры

Вы можете увидеть все доступные плейсхолдеры заказа просто указав пустой чанк:

``` php
<pre>[[!msGetOrder?tpl=``]]</pre>
```

[![](https://file.modx.pro/files/3/a/9/3a922d1321d8f853aada28c176b21767s.jpg)](https://file.modx.pro/files/3/a/9/3a922d1321d8f853aada28c176b21767.png)

## Создание заказа

Данный сниппет рекомендуется вызывать в связке с другими на странице оформления заказа:

``` php
[[!msCart]] <!-- Просмотр и изменение корзины, скрывается после создания заказа -->

[[!msOrder]] <!-- Форма оформления заказа, скрывается после его создания -->

[[!msGetOrder]] <!-- Вывод информации о заказе, показывается после его создания -->
```

## Оформление писем

Этот сниппет используется классом miniShop2 для оформления почтовых уведомлений покупателям, если вы включили их отправку в [настройках статусов][3].
Все переменные сниппета `msGetOrder`: **order**, **products**, **user**, **address**, **delivery**, **payment** и **total** также доступны для использования в письмах почтовых уведомлений.

По умолчанию все письма расширяют один базовый почтовый шаблон **tpl.msEmail** и меняют заданные в нём блоки:

- **logo** - логотип магазина со ссылкой на главную страницу
- **title** - заголовок письма
- **products** - таблица заказанные товаров
- **footer** - ссылка на сайте в подвале письма

Например, письмо с новым заказом покупателю выглядит так:

``` php
{extends 'tpl.msEmail'}

{block 'title'}
    {'ms2_email_subject_new_user' | lexicon : $order}
{/block}

{block 'products'}
    {parent}
    {if $payment_link?}
        <p style="margin-left:20px;{$style.p}">
            {'ms2_payment_link' | lexicon : ['link' => $payment_link]}
        </p>
    {/if}
{/block}
```

Как видите, здесь наследуется основной шаблон, меняется заголовок, а к таблице товаров добавляется ссылка на оплату (если есть).

[![](https://file.modx.pro/files/b/1/c/b1c563c0b075caf2afce7609ac3f15e4s.jpg)](https://file.modx.pro/files/b/1/c/b1c563c0b075caf2afce7609ac3f15e4.png)

Подробнее о расширении шаблонов вы можете прочитать в [документации Fenom][4].

[1]: /ru/01_Компоненты/01_pdoTools/04_Общие_параметры.md
[2]: /ru/01_Компоненты/01_pdoTools/03_Парсер.md
[3]: /ru/01_Компоненты/02_miniShop2/01_Интерфейс/04_Настройки.md
[4]: https://github.com/fenom-template/fenom/blob/master/docs/ru/tags/extends.md
