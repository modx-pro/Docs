# mspBePaid

## Начало работы

Для того, чтобы принимать оплату с помощью bePaid необходимо сначала подать заявку на [регистрацию в системе][3].

Помощь по интеграции модуля оплаты на сайт вы можете получить через [службу технической поддержки][4] либо напрямую у [разработчика в Минске][5] либо через [техническую поддержку][6] самой платежной системы.

## Системные требования

- PHP 5.5+
- MODX Revolution 2.4+
- MiniShop2

## Настройка bePaid

_**Важно! Для проверки механизма платежей пользуйтесь только тестовым окружением.**_

Для начала следует ознакомиться с требованиями к сайтам и интернет-магазинам:

- [Требования к сайту][7]
- [Процессинговый договор][8]

Так же вы можете запросить у менеджеров платежной системы дополнительные документы для ознакомления:

- Список документов
- Анкета клиента (ИП)
- Анкета клиента (Юридическое лицо)
- Эквайринговый договор (интернет-магазин)
- Эквайринговый договор (интернет-ресурс)

Достаточно написать письмо на адрес [sales@bepaid.by][9] или позвонить по телефонам +375 (17) 277-01-18, +375 (29) 664-00-24 (Республика Беларусь).

Для успешной работы с платежной системой вам понадобится логин и пароль, выданные после регистрации. Для начала необходимо зайти в [панель управления][10] и произвести первичную настройку системы согласно инструкции, предоставленной сотрудниками bePaid.

## Установка и настройка пакета в MODX

При установке пакета установщик предлагает ввести реквизиты тестового магазина для начала работы с платежной системой bePaid в MODX. Если вы уже зарегистрировались и получили все необходимые реквизиты, вы можете указать в этом окне настоящие идентификатор магазина и секретный ключ.

![](https://file.modx.pro/files/9/0/1/90111e6dfbd2530324bdab0743949e53.png)

Можно пропустить этот шаг и заполнить эти данные позже в системных настройках.

Затем нужно включить метод оплаты в настройках miniShop2 и добавить его к необходимому методу доставки. Если у вас уже действующий магазин на MODX и MiniShop2 - настройка на этом закончена. Если же вы делаете новый сайт - то о том, как работать с платежными системами в miniShop2 следует ознакомиться в [документации по miniShop2][11] или задать вопрос на сайте [modx.pro][12].

![](https://file.modx.pro/files/0/f/6/0f6b8d2ba7a75229c724f73fad7c7266.png)
![](https://file.modx.pro/files/9/2/b/92b5be07f0e8378e3e3cd1e16c10d44c.png)

Чтобы перевести режим оплат из тестового в «боевой», измените системную настройку **ms2_payment_bepaid_test_mode** с «Да» на «Нет».

Для более тонкой настройки платежного модуля существует целый набор системных настроек в соответствующем разделе MODX. Для выбора настроек следует выбрать пространство имен minishop2 и раздел bePaid.

![](https://file.modx.pro/files/8/6/8/868f31becc61e023a66dfd364efdf854.png)

Дополнительно с данным платежным модулем поставляется несколько плагинов для улучшения работы с системными настройками. Например, не нужно вписывать номер ресурса или статуса руками в текстовое поле, достаточно дважды кликнуть по значению и выбрать соответствующий вариант из выпадающего списка.

## ЕРИП и Халва

С версии модуля **2.2.0** поддерживается работа с картами "Халва" от МТБанк и выставление счетов в системе "Расчет" (ЕРИП).

В модуле реализованы два способа добавления новых методов оплаты на сайт.

Первый и самый простой - добавить необходимые методы в системную настройку **ms2_payment_bepaid_payment_types**.

Возможные значения указываются через запятую. Если поле пустое, по умолчанию используется значение **credit_card**.

- **credit_card** - оплата банковской картой
- **erip** - оплата через ЕРИП
- **halva** - оплата картой рассрочки "Халва"

Кроме того, для того, чтобы правильно выставить счет в системе "Расчет" (ЕРИП), необходимо знать номер услуги, присвоенный продавцу в системе и указать его в настройке **ms2_payment_bepaid_erip_service_id**. Для тестирования можно использовать значение **99999999**. Важно отметить, что из-за особенностей ЕРИП, тестирование таких платежей стоит проводить только на доступном в сети сайте.

При переходе на сайт платежной системы это будет выглядеть так.

![](https://file.modx.pro/files/e/8/3/e831747619852300a303bd7930968b19.png)

Второй способ, это добавить в настройках магазина новые способы оплаты, отдельный для карты "Халва" и отдельный для ЕРИП, и предоставить покупателю выбор на странице оформления заказа. Оба новых метода наследуют базовый класс, но в них по умолчанию предустановлен определенный тип оплаты.

## Справочник по системным настройкам

_**Важно!** В таблице ниже, для лучшей читаемости, ключи настроек представленны в коротком виде, без префикса **ms2_payment_bepaid_**._

| Описание                                                                                                                                                                                                                                                                                                             | Ключ                                                             | Значение по умолчанию |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------- | --------------------- |
| **Идентификатор магазина в системе bePaid** <br> Данный идентификатор создается при регистрации в системе bePaid и высылается в письме.                                                                                                                                                                              | store_id                                                         |                       |
| **Секретный ключ** <br> Последовательность случайных символов, участвует в формировании электронной подписи заказа, выдается при регистрации магазина в системе bePaid.                                                                                                                                              | secret_key                                                       |                       |
| **Язык bePaid** <br> Выберите язык, на котором показывать сайт bePaid при оплате. По умолчанию будет использоваться язык, установленный для сайта в системной настройке cultureKey.                                                                                                                                  | language                                                         | ru                    |
| **Страна по умолчанию** <br> Выберите страну, которая будет использоваться по умолчанию при совершении оплаты. Выбор страны можно переопределить через корзину. Рекомендуется выбирать страну, где расположен магазин.                                                                                               | country                                                          | by                    |
| **Статус заказа в случае успешной оплаты** <br> Если заказ обработан без ошибок и со стороны банка транзакция авторизована, статус заказа будет изменен на указанный.                                                                                                                                                | success_status                                                   | 2                     |
| **Статус заказа в случае ошибок оплаты** <br> Если заказ не обработан или были ошибки в процессе оплаты, статус заказа будет изменен на указанный.                                                                                                                                                                   | failure_status                                                   | 4                     |
| **Страница успешной оплаты bePaid** <br> Пользователь будет отправлен на эту страницу после успешного завершения оплаты. Рекомендуется указать страницу с корзиной для вывода деталей заказа.                                                                                                                        | success_page                                                     | 0                     |
| **Страница отмены оплаты bePaid** <br> Пользователь будет отправлен на эту страницу при неудачной оплате. Рекомендуется указать страницу с корзиной для вывода деталей заказа.                                                                                                                                       | failure_page                                                     | 0                     |
| **Валюта платежа** <br> Буквенный трехзначный код валюты согласно [ISO 4271][13].                                                                                                                                                                                                                                    | currency                                                         | BYR                   |
| **Входная точка API** <br> URL, куда будут отправляться запросы на оплату.                                                                                                                                                                                                                                           | checkout_url <br> `https://checkout.bepaid.by/ctp/api/checkouts` |                       |
| **Режим совершения тестовых платежей** <br> При значении "Да", все запросы оплаты будут отправляться на тестовую среду обработки платежей bePaid. Реальные карты в данном режиме не работают.                                                                                                                        | test_mode                                                        | Да                    |
| **Свойства заказа только для чтения** <br> Поля заказа, перечисленные в данном параметре, на странице оплаты будут доступны только для чтения (редактировать нельзя). Список доступных полей (указывается через запятую): *email*, *first_name*, *last_name*, *address*, *city*, *state*, *zip*, *phone*, *country*. | readonly_fields                                                  | email                 |
| **Скрытые свойства заказа** <br> Поля заказа, перечисленные в данном параметре, будут скрыты на странице оплаты, но при это будут записаны в параметры платежа. Список доступных полей (указывается через запятую): *phone*, *address*.                                                                              | hidden_fields                                                    |                       |
| **Версия платежной страницы** <br> На текущий момент актуальная версия протокола **2.1**. Если вы устанавливали компонент ранее, это значение следует обновить вручную.                                                                                                                                              | api_version                                                      | 2.1                   |
| **Доступные способы оплаты** <br> Массив способов оплаты для отображения на странице оплаты. Доступны следующие значения: **credit_card**, **erip**, **halva**. Для ЕРИП так же необходимо указать значение **erip_service_id**.                                                                                     | payment_types                                                    |                       |
| **Код услуги ЕРИП** <br> Уникальный код магазина или услуги, зарегистрированной для продавца в системе "Расчет". Для тестов используйте значение: **99999999**.                                                                                                                                                      | erip_service_id                                                  |                       |

[3]: https://bepaid.by/podat-zayavku/
[4]: https://modstore.pro/cabinet/tickets/
[5]: https://alroniks.com/
[6]: https://bepaid.by/contacts/
[7]: https://www.bepaid.by/wp-content/uploads/docs/bepaid.by%20%D0%A2%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F%20%D0%BA%20%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D0%BD%D0%B5%D1%82-%D0%BC%D0%B0%D0%B3%D0%B0%D0%B7%D0%B8%D0%BD%D1%83.docx
[8]: https://www.bepaid.by/wp-content/uploads/docs/bepaid.by%20%D0%9F%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%B8%D0%BD%D0%B3%D0%BE%D0%B2%D1%8B%D0%B9%20%D0%B4%D0%BE%D0%B3%D0%BE%D0%B2%D0%BE%D1%80.docx
[9]: mailto:sales@bepaid.by
[10]: https://merchant.bepaid.by/merchants/sign_in
[11]: http://docs.modx.pro/components/minishop2/
[12]: https://modx.pro/help/
[13]: http://en.wikipedia.org/wiki/ISO_4217
