# Отправка данных из форм

## Настройка

Убедитесь, что заполнены системные настройки:

- **amoconnector.enabled** — интеграция включена
- **amoconnector.form_pipeline_id** — ID воронки для форм (если пусто, используется `amoconnector.default_pipeline_id`)
- **amoconnector.form_status_id** — ID статуса для новых сделок из форм

## Хук amoConnectorHook

Для отправки данных из формы добавьте хук `amoConnectorHook` в вызов FormIt или AjaxForm:

```modx
[[!FormIt?
  &hooks=`email,amoConnectorHook`
  &amoFormName=`callback`
  &validate=`name:required,phone:required,email:email:required`
  &successMessage=`Спасибо, ваша заявка отправлена!`
]]
```

## Параметры хука

| Параметр | Описание |
|----------|----------|
| **&amoFormName** | Имя формы для идентификации в amoCRM. Используется в названии сделки |
| **&amoLeadName** | Шаблон названия сделки (переопределяет системную настройку `amoconnector.form_lead_name_tpl`) |
| **&amoPipelineId** | ID воронки (переопределяет системную настройку) |
| **&amoTags** | Теги через запятую (переопределяет системную настройку) |

## Маппинг полей

Компонент автоматически распознает стандартные поля формы:

- **email** — по паттерну `email` в имени поля
- **phone** — по паттерну `phone`, `tel`, `mobile`, `телефон`
- **name** — по паттерну `name`, `fullname`, `fio`, `имя`

Для кастомных полей настройте маппинг в CMP (вкладка «Маппинг полей», контекст `form`).

## Поведение

- Хук всегда возвращает `true` — ошибки amoCRM не блокируют отправку формы
- При наличии email или телефона выполняется дедупликация контактов
- К сделке добавляется примечание со всеми полями формы
- Если включен Scheduler — отправка выполняется асинхронно
